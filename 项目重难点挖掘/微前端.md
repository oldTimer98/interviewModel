# 项目脑图

# [📎微前端.xmind](https://www.yuque.com/attachments/yuque/0/2024/xmind/1931776/1713346795182-832aaf2e-ddb8-4bcf-bc8d-a7041af978e7.xmind)



# 背景

审批平台对接300个业务系统，开始用iframe 后来用前端进行微前端改造。主应用负责审批流程的节点，子应用负责展示业务表单页面。



# 难点一 业务系统过多 如何统一解决问题

三个措施

1. 标准脚手架  性能监控 埋点监控 snor 单元测试     对接公司组件库

亮点1 资产损失的自定义babel插件  禁止前端对金融变量赋默认值与计算。

亮点2 自定义loader插件 解决iframe 业务方css 兼容性问题  滑动不流畅 屏幕变大 rem失效     

1. weki沉淀场景
2. 上线收口 将上线权利收到我方 上线前检查 常见错误有没有修复



# 难点二 iframe 本身存在问题 如何进行低风险 进行微前端选型与改造

**老系统 IFrame 优缺点**

**做个应用框架，用 IFrame 嵌入目标系统**

- 优点 

- 改造成本低，只需要开发应用框架
- 可以支持同时打开多个系统并通过标签进行切换
- 切换系统时天然地可以维持页面的状态，让用户继续之前的操作路径
- 各应用独立部署，互不干扰

- 缺陷 

- IFrame 中的路由变化无法体现在应用框架的 URL 上，用户一刷新就会回归到初始页面，影响体验，需独立开发一套通讯机制让应用框架保存 IFrame 中系统的路由，需要对现有系统做改造
- IFrame 加载速度慢
- 若界面上 IFrame 较多，dom 结构会变得复杂，影响系统性能


**采用微前端架构，对应用进行改造**

- 优点 
- 真正可以做到在一个入口使用所有功能
- 不同应用间的切换体验较好，除了第一次切换需要消耗一定时间做 js 解析，后续的切换则较为平滑
- 主应用可以提供通用功能供子应用使用
- 不同应用可以由不同团队、使用不同的技术栈开发
- 缺陷 
- 有一定的改造工作量
- 主应用承载所有流量入口，无形中增大了系统压力

## 问题一 微前端选型优劣

qinakun webpack5 singleSPA  icestark   webComphonet 

webComphonet  自定义事件 自定义属性  每个子应用拥有独立的script和css，也可单独部署 

icestark  入侵小不需要了解各种生命周期

最终选择 **qinakun** 比较成熟 基于singleSPA优化

## 问题二

qinakun存在问题 与改造

1、ie 样式隔离 shaowdom 不支持 

loader 在子应用css类名起那增加前缀解决 工具postcss-selector-namespace   

2、跨域问题   

方案一 设置同域名

方案二 网关层做统一设置

3、依赖共用 主应用 子应用公用vue

4、登录问题	 碰到谷歌samesite

方案一 集团控域（tob 系统电脑公司可以控制用户浏览器设置 ）  

方案二 登录sso做 samesite=none 设置





# 项目成果

![img](https://cdn.nlark.com/yuque/0/2022/png/12658362/1670167760724-9bfc0d25-0228-4568-b579-5f4fa817312e.png)

# 失败复盘

![img](https://cdn.nlark.com/yuque/0/2022/png/12658362/1670167779646-c62e5c94-fee7-4a4b-9d73-f7cbad393cfe.png)





# 