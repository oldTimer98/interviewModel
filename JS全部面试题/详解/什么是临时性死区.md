## 基础

临时性死区（Temporal Dead Zone，简称TDZ）是指在JavaScript中使用let和const声明变量时，变量在其作用域中存在但无法被访问的现象。在TDZ中，尝试访问该变量会抛出 `ReferenceError` 异常。

![img](https://cdn.nlark.com/yuque/0/2023/png/32786640/1696559032281-59d0a28e-020e-4a63-a32e-b9aa0de0fd88.png)

TDZ 的设计是为了解决变量提升（hoisting）带来的问题。在ES6之前，使用var声明的变量存在变量提升，即变量的声明会被提升到当前作用域的顶部，这意味着你可以在变量声明之前访问该变量，但它的值会是undefined ，这一特性在过去经常引发意料之外且非常难以排查的异常(TDZ 之前可使用 eslint 检测)。

然而，使用let和const声明的变量不会发生变量提升，而是在声明语句处创建变量，并将其绑定到当前作用域。在变量声明之前，该变量处于TDZ中，无法被访问。只有在变量声明语句执行时，变量才会离开TDZ，可以安全地访问：

```javascript
console.log(x); // ReferenceError: x is not defined

let x = 10;
```

在上述示例中，我们尝试在变量x的声明语句之前访问该变量，但会引发 `ReferenceError`。这是因为x变量在其声明语句之前处于TDZ中。

TDZ的存在有助于在开发过程中捕获潜在的错误。它提醒我们在变量声明之前不要访问变量，以避免使用未初始化的变量。



## 进阶

### why 

临时性死区的意义在于引入了更严格的变量声明和使用规则，**规避变量提升带来的结构不稳定性**，提高代码的可靠性和可维护性(也可以借助 eslint 等静态检测工具发现问题)，拆解来看：

1. **错误捕获**：TDZ 的存在可以帮助开发者在开发过程中捕获潜在的错误。在变量声明之前访问变量会在静态检查阶段引发 `ReferenceError`，从而提醒开发者注意变量的声明和初始化顺序。这有助于避免使用未声明或未初始化的变量，减少代码中的潜在错误。
2. **可读性和维护性**：TDZ 要求在使用变量之前显式声明和初始化它们。这使得代码更易于阅读和理解，因为变量的使用点和定义点更加清晰明确。开发者可以更轻松地追踪变量的生命周期，并更好地组织和维护代码。
3. **避免变量提升问题**：在ES6之前，使用var声明的变量存在变量提升的问题，可能导致变量在使用之前被意外地访问。TDZ的引入消除了变量提升，强制开发者在使用变量之前进行显式声明和初始化，从而减少了因变量提升而产生的潜在问题。
4. **规范一致性**：TDZ的规则和行为在不同的JavaScript环境中是一致的，如浏览器和Node.js。这提供了跨平台和跨环境的一致性，使开发者可以编写可移植的代码，并减少由于环境差异而引起的错误。



### 变量提升可能带来什么问题

使用var声明变量时，变量提升可能导致以下潜在问题：

1. 未经意的变量访问：由于变量提升，变量的声明会被提升到当前作用域的顶部。这意味着在变量声明之前，变量已经存在，但其值为undefined。如果在变量声明之前使用变量，它将被视为存在但未定义，可能导致意外的行为或错误。



```javascript
console.log(x); // undefined
var x = 10;
```

1. 变量覆盖：由于变量提升，同一个作用域内的多个变量声明可能会相互覆盖。这可能导致变量值的意外改变或冲突。

```javascript
var x = 10;

function foo() {
  console.log(x); // undefined
  var x = 20;
  console.log(x); // 20
}

foo();
```

在上述示例中，变量x在函数foo中被重新声明，导致函数内部的x覆盖了外部的x。这可能会导致预期之外的结果。

1. 难以追踪变量声明：由于变量提升，变量的声明可能分散在作用域的不同位置。这使得代码阅读和理解变得困难，因为变量的声明点与其实际使用点不一致。这可能导致代码的可读性和维护性下降。

```javascript
function foo() {
  console.log(x); // undefined
  if (true) {
    var x = 10;
  }
  console.log(x); // 10
}

foo();
```

在上述示例中，变量x的声明在if语句块内部，但其在整个函数体内都可见。这可能使得开发者在阅读代码时难以追踪变量的声明和作用范围。

综上所述，使用var声明变量时，变量提升可能导致未经意的变量访问、变量覆盖以及难以追踪变量声明等潜在问题。这些问题可能引发意外的行为、错误和代码维护困难。ES6 引入的 let & const，以及对应的 TDZ 规则可以有效避免变量提升带来的潜在问题。



### 性能表现

临时性死区对代码的性能影响非常小，几乎可以忽略不计。

TDZ的主要目的是在开发过程中捕获潜在的错误，保证变量在使用之前被正确声明和初始化。它在代码执行之前进行静态检查，因此不会引入额外的运行时开销。

在实际的代码执行过程中，由于变量声明语句通常出现在作用域的顶部，TDZ只会在变量声明之前的短暂时间内存在。一旦变量声明执行完成，变量就可以正常使用，不再受到TDZ的限制。

此外，现代JavaScript引擎对变量的作用域和生命周期进行了优化，包括对TDZ的处理。引擎在编译阶段会进行优化，以便在运行时有效地处理变量的声明和访问。这些优化措施使得TDZ的影响对代码的实际性能几乎没有可观察的影响。

因此，从性能角度来看，TDZ的存在几乎没有明显的负面影响。它主要起到了代码静态检查和语法规范的作用，以确保变量的正确使用。在实际开发中，应该将注意力放在代码的可读性、可维护性和性能瓶颈的优化上，而不是过度担心TDZ带来的性能问题。