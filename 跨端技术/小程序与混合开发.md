## 前言

对于初中级和中小型公司小程序和混合开发被问的频率比较多。这里以主流的微信小程序和uni-app为例。



## 1. 小程序代码上线流程

答：首先使用开发者工具点击右上角的**上传代码**到小程序的管理后台（要填写正确的APPID），填写版本号和上线说明。

![img](https://cdn.nlark.com/yuque/0/2023/png/38811543/1692931222578-6c67c873-af3a-432c-9200-661c00da0196.png)

然后再**版本管理**里提交开发版本，代码上线需要一点时间。

![img](https://cdn.nlark.com/yuque/0/2023/png/38811543/1692931276398-223aa4b7-40b5-440f-aea4-49c04e3e8f8c.png)

审核通过后代码就上线了，上线之后还要配置一下**服务器域名**。

![img](https://cdn.nlark.com/yuque/0/2023/png/38811543/1692931324425-bcc5f42e-d9b6-46e2-9658-363b2ebbb51c.png)

## 2. 小程序开发中常见的问题有哪些？

答：

- 我觉得最糟糕的问题目前小程序的请求（普通请求，上传，下载等）都不支持Promise，都需要基于Promise重新封装。
- ![img](https://cdn.nlark.com/yuque/0/2023/png/38811543/1692931461971-b7125c25-8cca-45fa-bfac-6df675e48f58.png)
- 其次页面之间传参方式比较单一，普通页面能使用query和自定义事件，其他只能用公共区域（storage/App），没有像框架路由那样的动态路由。
- CSS样式不支持background；
- 事件的回调函数不能支持传参，导致节点上出现多的data-，参数来源比较难查看；
- 提交审核太慢了，极端情况需要几个小时才能通过。
- 基础库更新太快，API变来变去。

## 3. 小程序开发过程中遇到过什么比较困难的问题？怎么解决的

1. 多图片同时提交（二次封装wx.upload，配合Promise.allSettled）
2. 自定义分享图片（canvas二次绘制，在转成图片文件）
3. 登录、支付流程（login,requestpayment）

![img](https://cdn.nlark.com/yuque/0/2023/png/38811543/1692932259322-b8ab3a82-c926-4b49-87a1-b06ffd9c4398.png)

## 4. uni-app开发的优势？常见的兼容性问题？

答：uni-app采用了易上手的vue框架作为开发模板，上手难道较低。可以同时输出各种小程序和混合APP。

同时扩展了原生组件，提供了一些像easycom的方式更加方便开发。把各个平台的API做了兼容处理，最后就是提供了丰富的插件市场；

uni-app的兼容性主要体现在不同平台适配上，为了兼容性我们需要去通过#ifdef（编译判断）和运行时判断uni.getSystemInfoSync().platform。

## 5. 小程序中有哪些性能优化方法

答：小程序最常用的优化方法（微信小程序）：

1. 使用分包[subpackages](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#subpackages)分离非首屏代码 （首屏）
2. 使用代码预加载[preloadRule](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#preloadRule)优化分包加载 （首屏）
3.  全局配置"lazyCodeLoading": "requiredComponents"组件按需导入 （首屏）
4. 较大资源（图片视频）放入CDN （首屏）
5. 使用新的Skyline引擎替换部分webview
6. 使用CSS3动画代理[Animation](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.html)JS动画

## 6. bindtap和catchtap的区别

答：bind是支持冒泡，catch不冒泡

## 7. 小程序页面之间如何传递数据？

答：

1: query string（url）在调整to页面onload生命周期里面获取，switchTab 切换的时候不支持

2: stroage 

3: App() -- getApp() 

4: events自定义事件---**wx.navigateTo只有它才有**，this.getOpenerEventChannel()获取eventChannel

## 8. 小程序中，App 与 Page 分别有哪些生命周期，常用的有哪些？

答：App.js里面存放的全局生命周期

常用：onLaunch，通常全局初始化代码放这里，可以在这里获得登录code实现静默登录。

onError，监听报错，用于错误日志统计

onShow，切前台的时候执行代码

![img](https://cdn.nlark.com/yuque/0/2023/png/38811543/1694576814572-3d75a044-85f1-4022-95bf-cd71eb08f6ea.png)

以下是页面生命周期

常用的 onLoad，用于发请求，获取其他页面传递的数据。

onShow监听页面从新显示的回调，通过用于用户点击选择数据后再跳回来的时候处理逻辑。

![img](https://cdn.nlark.com/yuque/0/2023/png/38811543/1694576841326-c3bd8485-36f3-4627-bc83-73be7f01fff2.png)

## 9. 小程序的支付做过吗？大致流程是怎么样的？

答：我做过的，支付是比较常见的需求，分为下面几个步骤



1. 登录，调用wx.login获取登录的code，向我们的服务器发起登录请求，获取用户的openid
2. 前端用户下单，用户选好商品、填写收获地址、总价等信息，然后调用我们后端的下单接口，后端调用腾讯的统一下单接口，返回prepay_id(预支付码)，同时后端会把支付需要其他信息（时间戳timeStamp，随机串nonceStr，加密方式，签名paySign（把前面的几个数据加密过后的密钥））一并再下单接口响应里面返回给前端
3. 前端拿到数据后调用 wx.requestPayment ，传入对应的参数，在对应的回调函数里面做处理。

注意：是否真正支付成功是腾讯服务器给我们的后端响应的，前端的成功并不会修改订单状态。

```javascript
wx.requestPayment({
  timeStamp: '',
  nonceStr: '',
  package: '',
  signType: 'MD5',
  paySign: '',
  success (res) { },
  fail (res) { }
})
```



## 10. 小程序的热启动与冷启动分别是什么？

答：

**热启动（Hot Start）**：

热启动指的是当用户**已经打开**过某个小程序，并且在一定时间内再次打开该小程序时所发生的启动方式。

在热启动中，小程序会从后台恢复，通常会保留用户的当前状态和数据，以提供更快的响应时间和更顺畅的用户体验。

这种方式能够充分利用已加载的资源和数据，因此通常启动速度比较快。

**冷启动（Cold Start）**：

冷启动是指用户**首次打开**或者长时间未使用小程序后再次打开小程序时所发生的启动方式。

在冷启动中，小程序需要重新加载所有必要的资源、数据和代码，因此启动速度相对较慢。

用户可能需要等待一段时间才能看到小程序的内容，这可能会影响用户体验。

## 11. 在小程序中，你通常会关注那些性能指标？

答：通常情况下关注冷启动加载性能和复杂页面加载性能。

**启动性能**：

- **启动时间**：小程序的启动时间应尽量短，以便用户可以快速进入应用。
- **冷启动和热启动时间**：冷启动是指从完全关闭状态启动应用，而热启动是指从后台切回应用。优化这两个时间可以提高用户体验。

**页面加载性能**：

- **页面加载时间**：确保页面能够在合理的时间内加载完成，减少用户等待时间。
- **页面渲染性能**：确保页面能够快速渲染，避免卡顿和滚动不流畅。复杂页面可使用skyline。

**网络性能**：

- **网络请求性能**：监测网络请求的速度和成功率，优化请求次数和数据传输大小。
- **缓存策略**：合理使用缓存，减少不必要的网络请求。

**资源优化**：

- **图片优化**：使用适当的图片格式和大小，减小图片资源的加载时间，视频图片资源使用CDN加载。
- **代码压缩**：使用上传时使用代码压缩来减小小程序的体积。满足兼容性前提下，使用高版本的JS语法（不转ES5）

## 12. 为什么我们能使用 Vue/React DSL 编写小程序？

答：

1. **开发者熟悉度**：许多前端开发者已经熟悉了 Vue 和 React 的语法和开发模式。使用相似的语法来编写小程序可以减少学习曲线，提高开发效率。
2. **组件化有限**：Vue 和 React 都采用了组件化的开发模式，这意味着开发者可以将用户界面划分为多个独立的组件，每个组件都有自己的状态和行为。虽然小程序自身有组件化，实现的力度比起前者要若一些。
3. **生态系统支持**：Vue 和 React 拥有更强大的生态系统，包括大量的第三方库和工具，可以帮助开发者解决各种问题。
4. **缺点**：打包出来的小程序需要去处理比较多的兼容性问题。

## 13. 聊聊 jsbridge 的基本原理

答：是一种用于在不同的运行环境中（通常是在浏览器和原生应用之间）进行通信和交互的技术。其基本原理是通过一些机制来使 JavaScript 代码和原生代码能够相互调用和传递数据。

下面是 JSBridge 的基本原理：

1. **接口定义**：

- 首先，原生应用会定义一些接口（API），这些接口允许 JavaScript 代码调用原生功能。接口通常以一种**标准格式或协议**来定义，以确保 JavaScript 和原生代码之间的交互是有序的。
- <protocol>://<host>/<path>?<qeury>#fragment

- 如果符合自定义的URL Schema，对URL进行解析，拿到相关操作、操作，进而调用原生Native的方法
- 如果不符合自定义的URL Schema，就直接转发，请求真正的服务



1. **桥接对象**：

- 在 JavaScript 端，一个名为桥接对象（Bridge Object）通常会被创建。这个对象充当了 JavaScript 代码和原生代码之间的中介，它包含了可以调用原生接口的方法，同时也可以接受来自原生应用的回调。

```java
//安卓
String jsCode = String.format("window.showWebDialog('%s')", text);
webView.evaluateJavascript(jsCode, new ValueCallback<String>() {
  @Override
  public void onReceiveValue(String value) {

  }
});

//IOS
[webView evaluateJavaScript:@"执行的JS代码" completionHandler:^(id _Nullable response, NSError * _Nullable error) {

}];
```

1. **通信通道**：

- JSBridge 需要一个通信通道，用于在 JavaScript 和原生代码之间传递消息和数据。这个通道可以是 WebView 中的消息传递机制，也可以是其他原生与 JavaScript 通信的机制，如原生应用提供的 JavaScript 接口。

1. **调用和回调**：

- JavaScript 代码通过调用桥接对象的方法来触发原生功能。这些方法会将请求和数据传递给原生应用。原生应用执行相应的操作，然后将结果通过回调函数传递回 JavaScript 代码。

1. **异步通信**：

- 由于跨平台通信通常是异步的，JSBridge 在设计时需要支持异步操作。JavaScript 代码通常会提供回调函数，原生应用在完成操作后将结果传递给这些回调函数，以便 JavaScript 代码可以继续执行。

1. **错误处理**：

- JSBridge 也需要考虑错误处理机制。如果发生错误，原生应用应该能够将错误信息传递给 JavaScript 代码，以便 JavaScript 代码可以采取适当的措施。