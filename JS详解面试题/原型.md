# æ·±å…¥ç†è§£ JavaScript ä¸­çš„åŸå‹

---

## ä»€ä¹ˆæ˜¯åŸå‹ï¼Ÿ

åŸå‹æ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼ŒJavaScript ä¸­æ‰€æœ‰çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…ç½®å±æ€§ï¼Œç§°ä¸ºå®ƒçš„**åŸå‹**ï¼Œå®ƒæ˜¯ JavaScript å®ç°ç»§æ‰¿å’Œå…±äº«æ–¹æ³•çš„æœºåˆ¶ã€‚

---

## 1. åŸå‹çš„æœ¬è´¨

åœ¨ JavaScript ä¸­ï¼Œæ¯ä¸ªå‡½æ•°ï¼ˆåŒ…æ‹¬æ„é€ å‡½æ•°ï¼‰éƒ½æœ‰ä¸€ä¸ª**æ˜¾å¼åŸå‹ `prototype`** å±æ€§ã€‚æ˜¾å¼åŸå‹ `prototype` æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯**åŸå‹å¯¹è±¡**ã€‚

> ğŸ’¡ æ€è€ƒä¸€ä¸‹ï¼Œå‡½æ•°æ˜¯å¯¹è±¡å—ï¼Ÿ

- è¿™ä¸ªåŸå‹å¯¹è±¡å¯ä»¥æä¾›æ–¹æ³•å’Œå±æ€§ï¼Œä¾›å…¶ä»–å¯¹è±¡ç»§æ‰¿å’Œä½¿ç”¨
- å®ƒæœ¬èº«æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŸå‹å¯¹è±¡ä¼šæœ‰å®ƒè‡ªå·±çš„éšå¼åŸå‹ `__proto__` å±æ€§
- åœ¨å‘ä¸ŠæŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­é€æ¸æ„æˆäº†**åŸå‹é“¾**
- åŸå‹é“¾ç»ˆæ­¢äº `null`ï¼Œä¹Ÿå°±æ˜¯ `Object.prototype.__proto__ === null`

```javascript
// ç¤ºä¾‹ï¼šAnimal.prototype æ˜¯ Animal æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡
function Animal() {}

// å®ƒé»˜è®¤æœ‰ä¸€ä¸ª constructor å±æ€§ï¼ŒæŒ‡å‘ Animal æœ¬èº«
console.log(Animal.prototype.constructor === Animal); // true
```

---

## 2. å¯¹è±¡çš„ `__proto__`

æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª**éšå¼åŸå‹ï¼ˆ`__proto__`ï¼‰**éšè—å±æ€§ï¼Œå®ƒæŒ‡å‘åˆ›å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„ `prototype`ã€‚

> ğŸ“– **çº¢å®ä¹¦åŸæ–‡**ï¼šæ¯æ¬¡è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºçš„ä¸€ä¸ªæ–°å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹çš„å†…éƒ¨æœ‰ä¸€ä¸ª `[[Prototype]]` æŒ‡é’ˆå°±ä¼šè¢«èµ‹å€¼ä¸ºæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚å› ä¸º JavaScript è„šæœ¬ä¸­æ²¡æœ‰è®¿é—®è¿™ä¸ª `[[Prototype]]` ç‰¹æ€§çš„æ ‡å‡†æ–¹å¼ï¼Œä½†æ˜¯ Firefoxã€Safari å’Œ Chrome ä¼šåœ¨æ¯ä¸ªå¯¹è±¡ä¸Šæš´éœ² `__proto__` å±æ€§ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥è®¿é—®å¯¹è±¡çš„åŸå‹ã€‚

```javascript
function Animal() {}
let dog = new Animal();

// dog.__proto__ æŒ‡å‘ Animal.prototype
console.log(dog.__proto__ === Animal.prototype); // true

// Animal.prototype æ˜¯ dog è¿™ä¸ªå®ä¾‹çš„åŸå‹
```

---

## 3. åŸå‹çš„ä½œç”¨

åŸå‹çš„æœ€å¤§ä½œç”¨æ˜¯**å…±äº«å±æ€§å’Œæ–¹æ³•**ï¼Œä½¿å¾—æ‰€æœ‰é€šè¿‡ç›¸åŒæ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹å¯¹è±¡å¯ä»¥å…±äº«ç›¸åŒçš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªå®ä¾‹éƒ½åˆ›å»ºæ–°çš„æ–¹æ³•ã€‚

```javascript
function Animal(name) {
  this.name = name;
}

// sayHello æ–¹æ³•åªåœ¨ Animal.prototype ä¸Šå®šä¹‰äº†ä¸€æ¬¡
Animal.prototype.sayHello = function() {
  console.log(`Hello, I'm ${this.name}`);
};

let dog1 = new Animal('Dog1');
let dog2 = new Animal('Dog2');

// æ‰€æœ‰ Animal çš„å®ä¾‹éƒ½å¯ä»¥é€šè¿‡åŸå‹é“¾è®¿é—®è¯¥æ–¹æ³•
dog1.sayHello(); // Hello, I'm Dog1
dog2.sayHello(); // Hello, I'm Dog2

// è€Œä¸æ˜¯ä¸ºæ¯ä¸ªå®ä¾‹éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„æ–¹æ³•
console.log(dog1.sayHello === dog2.sayHello); // true
```

**ä¼˜åŠ¿**ï¼šèŠ‚çœäº†å†…å­˜ï¼Œå¹¶æé«˜äº†ä»£ç å¤ç”¨æ€§ã€‚

---

## 4. åŸå‹é“¾

å¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰æŸä¸ªå±æ€§æˆ–æ–¹æ³•ï¼ŒJavaScript å¼•æ“ä¼šæ²¿ç€**åŸå‹é“¾ï¼ˆPrototype Chainï¼‰**å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å±æ€§æˆ–æ–¹æ³•ï¼Œæˆ–è€…ç›´åˆ° `null` ä¸ºæ­¢ï¼ˆå³åˆ°è¾¾åŸå‹é“¾çš„é¡¶ç«¯ï¼‰ã€‚

```javascript
function Animal() {}
let dog = new Animal();

// æŸ¥æ‰¾è¿‡ç¨‹ï¼š
// 1. dog.toString() åœ¨ dog å¯¹è±¡æœ¬èº«æ‰¾ä¸åˆ°
// 2. dog.__proto__ï¼ˆå³ Animal.prototypeï¼‰ä¸Šä¹Ÿæ²¡æœ‰ toString æ–¹æ³•
// 3. ç»§ç»­æŸ¥æ‰¾ Animal.prototype.__proto__ï¼ˆå³ Object.prototypeï¼‰
// 4. è¿™é‡Œæ‰¾åˆ°äº† toString æ–¹æ³•ï¼Œæœ€ç»ˆæ‰§è¡Œ Object.prototype.toString()

console.log(dog.toString()); // [object Object]
```

```mermaid
flowchart TB
    A["dog å®ä¾‹"] --> B["dog.__proto__\n(Animal.prototype)"]
    B --> C["Animal.prototype.__proto__\n(Object.prototype)"]
    C --> D["Object.prototype.__proto__\n(null)"]
    
    style A fill:#4a9eff,stroke:#333,color:#fff
    style B fill:#5c6bc0,stroke:#333,color:#fff
    style C fill:#26a69a,stroke:#333,color:#fff
    style D fill:#ef5350,stroke:#333,color:#fff
```

---

## 5. åŸå‹çš„ constructor å±æ€§

`prototype` å¯¹è±¡é»˜è®¤æœ‰ä¸€ä¸ª `constructor` å±æ€§ï¼ŒæŒ‡å‘å…¶å…³è”çš„æ„é€ å‡½æ•°ã€‚

```javascript
function Animal() {}
let dog = new Animal();

// constructor å±æ€§å¯ä»¥ç”¨äºåˆ›å»ºæ–°çš„å®ä¾‹
console.log(dog.constructor === Animal); // true

// å› æ­¤å¯ä»¥é€šè¿‡ new dog.constructor('Max') åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹
let newDog = new dog.constructor();
```

---

## 6. ä¿®æ”¹ prototype çš„æ³¨æ„äº‹é¡¹

å¦‚æœç›´æ¥ä¿®æ”¹ `prototype`ï¼Œéœ€è¦**æ‰‹åŠ¨ä¿®æ­£ `constructor`**ï¼Œå¦åˆ™ `constructor` ä¼šæŒ‡å‘é”™è¯¯çš„å¯¹è±¡ã€‚

### âŒ é”™è¯¯ç¤ºä¾‹

```javascript
function Animal() {}

Animal.prototype = {
  sayHello: function() {
    console.log('Hello');
  }
};

let dog = new Animal();
console.log(dog.constructor === Animal); // false âŒ
console.log(dog.constructor === Object); // trueï¼ˆæŒ‡å‘äº† Objectï¼‰
```

### âœ… ä¿®æ­£æ–¹å¼

```javascript
Animal.prototype = {
  constructor: Animal, // æ‰‹åŠ¨ä¿®æ­£ constructor
  sayHello: function() {
    console.log('Hello');
  }
};

let dog = new Animal();
console.log(dog.constructor === Animal); // true âœ…
```

---

## 7. åŸå‹ vs `__proto__` vs prototype çš„åŒºåˆ«

| æœ¯è¯­ | ä½œç”¨ |
|---|---|
| **prototype** | æ„é€ å‡½æ•°çš„å±æ€§ï¼ŒæŒ‡å‘è¯¥æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡çš„åŸå‹ |
| **`__proto__`** | å¯¹è±¡çš„å±æ€§ï¼ŒæŒ‡å‘åˆ›å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„ `prototype` |
| **constructor** | `prototype` çš„é»˜è®¤å±æ€§ï¼ŒæŒ‡å‘æ„é€ å‡½æ•°æœ¬èº« |

### å…³ç³»ç¤ºæ„å›¾

```javascript
function Animal() {}
let dog = new Animal();

console.log(dog.__proto__ === Animal.prototype);          // true
console.log(Animal.prototype.constructor === Animal);     // true
```

```mermaid
flowchart LR
    A["Animal\n(æ„é€ å‡½æ•°)"] -->|prototype| B["Animal.prototype\n(åŸå‹å¯¹è±¡)"]
    B -->|constructor| A
    C["dog\n(å®ä¾‹å¯¹è±¡)"] -->|__proto__| B
    
    style A fill:#4a9eff,stroke:#333,color:#fff
    style B fill:#5c6bc0,stroke:#333,color:#fff
    style C fill:#26a69a,stroke:#333,color:#fff
```

---

## é¢„å‘Šï¼šåŸå‹é“¾çš„åº”ç”¨

- **åŸå‹é“¾**å…è®¸å¯¹è±¡ç»§æ‰¿æ¥è‡ªæ„é€ å‡½æ•° `prototype` çš„æ–¹æ³•å’Œå±æ€§
- å¯¹è±¡çš„ `__proto__` æŒ‡å‘å…¶æ„é€ å‡½æ•°çš„ `prototype`ï¼Œå½¢æˆå±‚å±‚æŸ¥æ‰¾çš„åŸå‹é“¾
- `instanceof` é€šè¿‡åŸå‹é“¾æ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸ºæŸä¸ªæ„é€ å‡½æ•°çš„å®ä¾‹ï¼š

```javascript
console.log(dog instanceof Animal); // true
console.log(dog instanceof Object); // true
```
