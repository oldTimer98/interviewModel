# å¾®å‰ç«¯æ¶æ„è¯¦è§£

> ğŸ“¦ é¡¹ç›® GitHub åœ°å€ï¼šhttps://github.com/DevWizardFeng/MicroFrontendLab/tree/main

---

## é¡¹ç›®äº®ç‚¹

- å¾®å‰ç«¯æ¦‚å¿µåŠåº”ç”¨
- SystemJS æºç 
- single-spa å®æˆ˜åŠæºç 
- qiankun å®æˆ˜åŠæºç ï¼ˆæ²™ç®±åŸç†ï¼‰- èš‚èšé‡‘æœ
- MicroAppã€WebComponent å®æˆ˜åŠæºç  - äº¬ä¸œé›¶å”®
- wujie å®æˆ˜ä½¿ç”¨ - è…¾è®¯
- Webpack5 Module Federation Emp2 å®æˆ˜

---

## ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å¾®å‰ç«¯

> å¾®å‰ç«¯å°±æ˜¯å°†ä¸åŒçš„åŠŸèƒ½æŒ‰ç…§ä¸åŒçš„ç»´åº¦æ‹†åˆ†æˆå¤šä¸ªå­åº”ç”¨ï¼Œé€šè¿‡ä¸»åº”ç”¨æ¥åŠ è½½è¿™äº›å­åº”ç”¨ã€‚

**å¯¹æ¯”æ¡ˆä¾‹**ï¼šDeepTableã€DeepUxã€DeepModelã€DeepFlowã€DeepBI

> ğŸ’¡ å¾®å‰ç«¯çš„æ ¸å¿ƒåœ¨äº**æ‹†**ï¼Œæ‹†å®Œåå†**åˆ**ï¼Œå®ç°åˆ†è€Œæ²»ä¹‹ï¼

### 1. å¾®å‰ç«¯è§£å†³çš„é—®é¢˜

| é—®é¢˜ | è¯´æ˜ |
|---|---|
| **æŠ€æœ¯æ ˆä¸åŒ** | ä¸åŒå›¢é˜ŸåŒæ—¶å¼€å‘ä¸€ä¸ªåº”ç”¨ |
| **ç‹¬ç«‹éƒ¨ç½²** | æ¯ä¸ªå›¢é˜Ÿå¼€å‘çš„æ¨¡å—éƒ½å¯ä»¥ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½² |
| **å¢é‡è¿ç§»** | å®ç°æ¸è¿›å¼çš„ç³»ç»Ÿå‡çº§ |

### 2. å¦‚ä½•å®ç°å¾®å‰ç«¯

å°†ä¸€ä¸ªåº”ç”¨åˆ’åˆ†æˆè‹¥å¹²ä¸ªå­åº”ç”¨ï¼Œå°†å­åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªä¸ªçš„æ¨¡å—ã€‚å½“è·¯å¾„åˆ‡æ¢æ—¶åŠ è½½ä¸åŒçš„å­åº”ç”¨ã€‚è¿™æ ·æ¯ä¸ªå­åº”ç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæŠ€æœ¯æ ˆä¹Ÿä¸ç”¨åšé™åˆ¶äº†ï¼

### 3. å®ç°å¾®å‰ç«¯çš„æŠ€æœ¯æ–¹æ¡ˆ

éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼š
- é‡‡ç”¨ä½•ç§æ–¹æ¡ˆè¿›è¡Œåº”ç”¨æ‹†åˆ†ï¼Ÿ
- é‡‡ç”¨ä½•ç§æ–¹å¼è¿›è¡Œåº”ç”¨é€šä¿¡ï¼Ÿ
- åº”ç”¨ä¹‹é—´å¦‚ä½•è¿›è¡Œéš”ç¦»ï¼Ÿ

#### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---|---|---|
| **iframe** | å®Œç¾çš„æ²™ç®±æœºåˆ¶ï¼Œè‡ªå¸¦åº”ç”¨éš”ç¦» | ç”¨æˆ·ä½“éªŒå·®ï¼ˆå¼¹æ¡†åªèƒ½åœ¨ iframe ä¸­ã€åˆ·æ–°ä¸¢å¤±çŠ¶æ€ï¼‰ |
| **Web Components** | Shadow DOM å¤©ç”Ÿä½œç”¨åŸŸéš”ç¦» | æµè§ˆå™¨å…¼å®¹æ€§ã€å­¦ä¹ æˆæœ¬ã€è°ƒè¯•å›°éš¾ |
| **single-spa** | è·¯ç”±åŠ«æŒå®ç°åº”ç”¨åŠ è½½ï¼Œæä¾›å…¬å…±ç»„ä»¶åŠ è½½ | æ— æ²™ç®±æœºåˆ¶ï¼Œéœ€è¦è‡ªå·±å®ç° JS/CSS æ²™ç®± |
| **Module Federation** | æ¨¡å—è”é‚¦ï¼Œå…±äº«æ¨¡å—é€šä¿¡ | éœ€è¦ Webpack5ï¼Œæ—  CSS/JS æ²™ç®± |

### 4. Why Not Iframeï¼Ÿ

> å¦‚æœä¸è€ƒè™‘ä½“éªŒé—®é¢˜ï¼Œiframe å‡ ä¹æ˜¯æœ€å®Œç¾çš„å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆã€‚

**iframe çš„é—®é¢˜**ï¼š

| é—®é¢˜ | è¯´æ˜ |
|---|---|
| **URL ä¸åŒæ­¥** | æµè§ˆå™¨åˆ·æ–° iframe url çŠ¶æ€ä¸¢å¤±ã€åé€€å‰è¿›æŒ‰é’®æ— æ³•ä½¿ç”¨ |
| **UI ä¸åŒæ­¥** | DOM ç»“æ„ä¸å…±äº«ï¼Œå¼¹æ¡†æ— æ³•å±…ä¸­æ˜¾ç¤º |
| **å…¨å±€ä¸Šä¸‹æ–‡éš”ç¦»** | å†…å­˜å˜é‡ä¸å…±äº«ï¼Œcookie é€ä¼ å›°éš¾ |
| **æ€§èƒ½é—®é¢˜** | æ¯æ¬¡å­åº”ç”¨è¿›å…¥éƒ½æ˜¯æµè§ˆå™¨ä¸Šä¸‹æ–‡é‡å»ºã€èµ„æºé‡æ–°åŠ è½½ |

---

## äºŒã€SystemJS å‰–æ

> SystemJS æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¨¡å—åŠ è½½å™¨ï¼Œå®ƒèƒ½åœ¨æµè§ˆå™¨ä¸ŠåŠ¨æ€åŠ è½½æ¨¡å—ã€‚

å¾®å‰ç«¯çš„æ ¸å¿ƒå°±æ˜¯**åŠ è½½å¾®åº”ç”¨**ï¼Œæˆ‘ä»¬å°†åº”ç”¨æ‰“åŒ…æˆæ¨¡å—ï¼Œåœ¨æµè§ˆå™¨ä¸­é€šè¿‡ SystemJS æ¥åŠ è½½æ¨¡å—ã€‚

---

## ä¸‰ã€single-spa å®æˆ˜

### 1. å®‰è£…è„šæ‰‹æ¶

```bash
npm install create-single-spa -g
create-single-spa substrate  # é€šè¿‡ single-spa-cli åˆ›å»ºåŸºåº§åº”ç”¨
```

åˆ›å»ºé€‰é¡¹ï¼š
- `single-spa application / parcel` - åˆ›å»ºå­é¡¹ç›®
- `in-browser utility module` - ç”¨äºè·¨åº”ç”¨å…±äº« JavaScript é€»è¾‘çš„å¾®åº”ç”¨
- `single-spa root config` - åˆ›å»ºåŸºåº§å®¹å™¨

### 2. ç”Ÿæˆ React å­åº”ç”¨

```bash
create-single-spa react-project
npm install react-router-dom
```

#### webpack.config.js é…ç½®

åœ¨ `index.ejs` å’Œ `jw-root-config.js` ä¸­æ³¨å†Œå­åº”ç”¨ã€‚

### 3. ç”Ÿæˆ Vue å­åº”ç”¨

```bash
create-single-spa vue-project
```

#### vue.config.js é…ç½®

åœ¨ `substrate/index.ejs` ä¸­æ·»åŠ è·¯ç”±è·³è½¬ï¼Œç„¶åå¯åŠ¨ä¸‰ä¸ªé¡¹ç›®å³å¯çœ‹åˆ°æ•ˆæœã€‚

---

## å››ã€single-spa æºç è§£æ

### 1. æ ¸å¿ƒåŠŸèƒ½å›é¡¾

```html
<script src="https://cdn.bootcdn.net/ajax/libs/single-spa/5.9.3/umd/single-spa.min.js"></script>
```

single-spa çš„æ ¸å¿ƒåŠŸèƒ½ï¼š
- **æ³¨å†Œåº”ç”¨** `registerApplication`
- **å¯åŠ¨åº”ç”¨** `start`
- **ç”Ÿå‘½å‘¨æœŸ**ï¼š`bootstrap`ã€`mount`ã€`unmount`ï¼ˆå¿…é¡»å®ç°ï¼‰ï¼Œ`unload`ï¼ˆå¯é€‰ï¼‰

### 2. æ ¸å¿ƒæ–¹æ³•å®ç°

#### app.js çš„ä¸»è¦ä½œç”¨

```mermaid
flowchart TD
    A["registerApplication\næ³¨å†Œåº”ç”¨"] --> B["åˆ›å»ºåº”ç”¨å¯¹è±¡"]
    B --> C["æ·»åŠ åˆ° apps æ•°ç»„"]
    C --> D["åˆå§‹åŒ–çŠ¶æ€: NOT_LOADED"]
    D --> E["è§¦å‘ reroute"]
    E --> F["æ£€æŸ¥å½“å‰URL"]
    F --> G["åŠ è½½/æ¿€æ´»/å¸è½½åº”ç”¨"]
    
    style A fill:#4a9eff,stroke:#333,color:#fff
    style B fill:#5c6bc0,stroke:#333,color:#fff
    style C fill:#5c6bc0,stroke:#333,color:#fff
    style D fill:#26a69a,stroke:#333,color:#fff
    style E fill:#ff9800,stroke:#333,color:#fff
    style F fill:#ff9800,stroke:#333,color:#fff
    style G fill:#66bb6a,stroke:#333,color:#fff
```

#### app.helpers.js çŠ¶æ€å®šä¹‰

| çŠ¶æ€ | è¯´æ˜ |
|---|---|
| `NOT_LOADED` | æœªåŠ è½½ |
| `LOADING_SOURCE_CODE` | åŠ è½½ä¸­ |
| `NOT_BOOTSTRAPED` | æœªå¯åŠ¨ |
| `NOT_MOUNTED` | æœªæŒ‚è½½ |
| `MOUNTED` | å·²æŒ‚è½½ |

#### ç”Ÿå‘½å‘¨æœŸç®¡ç†

| æ–‡ä»¶ | ä½œç”¨ |
|---|---|
| **bootstrap.js** | å¤„ç†åº”ç”¨å¯åŠ¨æµç¨‹ï¼Œæ‰§è¡Œ `bootstrap` æ–¹æ³• |
| **load.js** | å¤„ç†åº”ç”¨åŠ è½½æµç¨‹ï¼ŒåŠ è½½åº”ç”¨ä»£ç  |
| **mount.js** | å¤„ç†åº”ç”¨æŒ‚è½½æµç¨‹ï¼Œæ‰§è¡Œ `mount` æ–¹æ³• |
| **unmount.js** | å¤„ç†åº”ç”¨å¸è½½æµç¨‹ï¼Œæ‰§è¡Œ `unmount` æ–¹æ³• |

#### navigation-event.js å¯¼èˆªç³»ç»Ÿ

ä¸»è¦ä½œç”¨ï¼š
- **åŠ«æŒè·¯ç”±äº‹ä»¶**ï¼šç›‘å¬ `hashchange` å’Œ `popstate` äº‹ä»¶
- **é‡å†™äº‹ä»¶ç›‘å¬å™¨**ï¼šæ§åˆ¶ `addEventListener` å’Œ `removeEventListener`
- **æ‹¦æˆªå†å² API**ï¼šå¯¹ `pushState` å’Œ `replaceState` è¿›è¡Œè¡¥ä¸

---

## äº”ã€qiankun ä»å…¥é—¨åˆ°å®æˆ˜

### 1. åˆ›å»º React ä¸»åº”ç”¨ï¼ˆSubstrateï¼‰

```bash
npx create-react-app substrate
cd substrate
npm install qiankun
```

åœ¨ `src/App.js` ä¸­é…ç½®ä¹¾å¤ï¼Œæ³¨å†Œå­åº”ç”¨å¹¶å¯åŠ¨ã€‚

### 2. åˆ›å»º React å­åº”ç”¨ï¼ˆm-reactï¼‰

```bash
npx create-react-app m-react
npm install @rescripts/cli
```

> `@rescripts/cli` å…è®¸ä½ åœ¨ä¸éœ€è¦ 'eject' çš„æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰ Create React App çš„ webpack é…ç½®ã€‚

#### å…³é”®é…ç½®

| æ–‡ä»¶ | å†…å®¹ |
|---|---|
| **package.json** | ä½¿ç”¨ `@rescripts/cli` |
| **.rescriptsrc.js** | é…ç½® webpackï¼Œè¾“å‡º UMD æ ¼å¼ |
| **src/index.js** | æš´éœ²ç”Ÿå‘½å‘¨æœŸç»™ä¹¾å¤ |
| **src/public-path.js** | åŠ¨æ€è®¾ç½® publicPath |
| **.env** | `PORT=40000`ã€`WDS_SOCKET_PORT=40000` |

### 3. åˆ›å»º Vue å­åº”ç”¨ï¼ˆm-vueï¼‰

```bash
vue create m-vue
```

#### vue.config.js é…ç½®

```javascript
module.exports = {
  devServer: {
    headers: {
      'Access-Control-Allow-Origin': '*',
    },
  },
  configureWebpack: {
    output: {
      library: 'm-vue',
      libraryTarget: 'umd',
    },
  },
}
```

### 4. åŠ¨æ€åŠ è½½ static å­åº”ç”¨

å¯¹äºé webpack æ„å»ºçš„é¡¹ç›®ï¼ˆå¦‚ jQueryã€jspï¼‰ï¼Œå¯ä»¥é€šè¿‡ `loadMicroApp` åŠ¨æ€åŠ è½½ã€‚

```bash
http-server -p 30000 --cors  # é€šè¿‡ http-server å¯åŠ¨é™æ€èµ„æº
```

### 5. ä¸»å­åº”ç”¨é—´é€šè®¯

ä½¿ç”¨ `initGlobalState` åœ¨ä¸»åº”ç”¨å®šä¹‰å…¨å±€çŠ¶æ€ï¼Œå¾®åº”ç”¨é€šè¿‡ props è·å–é€šä¿¡æ–¹æ³•ã€‚

### 6. æ ·å¼éš”ç¦»

| æ¨¡å¼ | è¯´æ˜ | ç¼ºç‚¹ |
|---|---|---|
| **experimentalStyleIsolation** | åŠ¨æ€æ·»åŠ å±æ€§ï¼Œé‡å†™ CSS é€‰æ‹©å™¨ | æ€§èƒ½å½±å“ï¼ŒåŠ¨æ€æ’å…¥æ ·å¼å¯èƒ½å¤±æ•ˆ |
| **strictStyleIsolation** | ä½¿ç”¨ Shadow DOM å°è£… | æµè§ˆå™¨å…¼å®¹æ€§ï¼Œå­åº”ç”¨ DOM æŒ‚è½½åˆ°å¤–å±‚æ ·å¼å¤±æ•ˆ |

### 7. Web Components

Web Components ç”±ä¸‰ä¸ªä¸»è¦æŠ€æœ¯ç»„æˆï¼š

| æŠ€æœ¯ | è¯´æ˜ |
|---|---|
| **Custom Elements** | åˆ›å»ºè‡ªå®šä¹‰ HTML æ ‡ç­¾ |
| **Shadow DOM** | å°è£…å†…éƒ¨ç»“æ„ã€æ ·å¼å’Œè¡Œä¸º |
| **HTML Templates** | `<template>` å’Œ `<slot>` å®šä¹‰å¯å¤ç”¨ç»“æ„ |

---

## å…­ã€qiankun JS æ²™ç®±åŸç†

### 1. ä»£ç†æ²™ç®±ï¼ˆProxy Sandboxï¼‰

ä½¿ç”¨ Proxy å¯¹è±¡åˆ›å»ºè™šæ‹Ÿå…¨å±€ç¯å¢ƒï¼Œå¾®åº”ç”¨å¯¹å…¨å±€ç¯å¢ƒçš„ä¿®æ”¹åªå½±å“ä»£ç†å¯¹è±¡ã€‚

### 2. å¿«ç…§æ²™ç®±ï¼ˆSnapshot Sandboxï¼‰

åœ¨å¾®åº”ç”¨æ¿€æ´»æ—¶å¯¹å…¨å±€ç¯å¢ƒè¿›è¡Œ"å¿«ç…§"ï¼Œå¸è½½æ—¶è¿˜åŸåˆ°å¿«ç…§çŠ¶æ€ã€‚

```mermaid
flowchart LR
    A["æ¿€æ´»åº”ç”¨"] --> B["æ‹æ‘„ window å¿«ç…§"]
    B --> C["åº”ç”¨è¿è¡Œ"]
    C --> D["è®°å½•ä¿®æ”¹"]
    D --> E["å¸è½½åº”ç”¨"]
    E --> F["è¿˜åŸ window"]
    
    style A fill:#4a9eff,stroke:#333,color:#fff
    style B fill:#5c6bc0,stroke:#333,color:#fff
    style C fill:#26a69a,stroke:#333,color:#fff
    style D fill:#ff9800,stroke:#333,color:#fff
    style E fill:#ef5350,stroke:#333,color:#fff
    style F fill:#66bb6a,stroke:#333,color:#fff
```

### 3. æ²™ç®±ç±»å‹å¯¹æ¯”

| ç±»å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|
| **SnapshotSandbox** | åŸºäºå¿«ç…§ï¼Œæµªè´¹å†…å­˜ | å•ä¾‹æ¨¡å¼ |
| **LegacySandbox** | åŸºäº Proxyï¼ŒèŠ‚çº¦å†…å­˜ | å•ä¾‹æ¨¡å¼ |
| **ProxySandbox** | å¤šä¸ª fakeWindow å®ä¾‹ | å¤šå®ä¾‹æ¨¡å¼ |

---

## ä¸ƒã€qiankun-master æºç è§£æ

### æ ¸å¿ƒæ–¹æ³•

```mermaid
flowchart TD
    A["registerMicroApps\næ³¨å†Œå¾®åº”ç”¨"] --> B["start()\nå¯åŠ¨åº”ç”¨"]
    B --> C["é¢„åŠ è½½\nrequestIdleCallback"]
    B --> D["æ²™ç®±åŠŸèƒ½\nCSS/JSæ²™ç®±"]
    B --> E["è·å–æ¥å…¥åè®®\næ‰©å±•ç”Ÿå‘½å‘¨æœŸ"]
    
    style A fill:#4a9eff,stroke:#333,color:#fff
    style B fill:#5c6bc0,stroke:#333,color:#fff
    style C fill:#26a69a,stroke:#333,color:#fff
    style D fill:#26a69a,stroke:#333,color:#fff
    style E fill:#26a69a,stroke:#333,color:#fff
```

### æµç¨‹æ€»ç»“

1. æ³¨å†Œé‡‡ç”¨ single-spaï¼Œ`start()` ä¹Ÿæ˜¯ single-spa
2. é¢„åŠ è½½åˆ©ç”¨ç©ºé—²æ—¶é—´ `requestIdleCallback`
3. æ²™ç®±åŠŸèƒ½ï¼šCSS æ²™ç®± + æ ·å¼éš”ç¦»ï¼ˆShadow DOMã€scopedCSSï¼‰
4. ä½¿ç”¨ `import-html-entry` æ›¿ä»£ SystemJS è¿›è¡Œæ–‡ä»¶åŠ è½½è§£æ
5. æ²™ç®±é™çº§æ–¹æ¡ˆ `autoDowngradeForLowVersionBrowser`

### qiankun å­˜åœ¨çš„é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|---|---|
| **ä¾èµ–å¤ç”¨** | å…±äº«æ¨¡å—æ‰“åŒ…åˆ° CDNï¼Œæˆ–ä½¿ç”¨ Module Federation |
| **ç»„ä»¶å¤ç”¨** | å°†ç»„ä»¶å•ç‹¬æ‰“åŒ…ä¸º NPM åŒ…æˆ–éƒ¨ç½²åˆ° CDN |
| **Vite æ”¯æŒ** | ç”Ÿäº§ç¯å¢ƒæ¥å…¥ Viteï¼Œæˆ–ä½¿ç”¨æ’ä»¶è½¬æ¢æ¨¡å—æ ¼å¼ |
| **åµŒå¥—é—®é¢˜** | é¿å…å¤šé‡æ²™ç®±åµŒå¥—ï¼Œåœ¨å­åº”ç”¨ä¸­å…³é—­æ²™ç®± |
| **CSS æ²™ç®±** | strictStyleIsolation å®Œå…¨éš”ç¦»ï¼Œæ ·å¼æ— æ³•ä¼ é€’åˆ°å­åº”ç”¨ |

---

## å…«ã€MicroApp ä½¿ç”¨

> [MicroApp å®˜ç½‘](https://micro-zoe.github.io/micro-app/) - äº¬ä¸œé›¶å”®å›¢é˜Ÿæ‰“é€ 

### 1. åŸºåº§åº”ç”¨é…ç½®

```bash
npm install @micro-zoe/micro-app --save
```

```javascript
// åœ¨åŸºåº§åº”ç”¨ä¸­å¼•å…¥ microApp å¹¶åˆå§‹åŒ–
import microApp from '@micro-zoe/micro-app'
microApp.start()
```

### 2. åµŒå…¥å­åº”ç”¨

```jsx
// Vue å­åº”ç”¨ç»„ä»¶
<micro-app name='vue-app' url='http://localhost:3001/' baseroute='/vue'></micro-app>

// React å­åº”ç”¨ç»„ä»¶
<micro-app name='react-app' url='http://localhost:3002/' baseroute='/react'></micro-app>
```

### 3. å­åº”ç”¨æ”¹é€ 

#### Vue å­åº”ç”¨

```javascript
// vue.config.js è·¨åŸŸæ”¯æŒ
module.exports = {
  devServer: {
    headers: {
      'Access-Control-Allow-Origin': '*',
    },
  },
}
```

#### React å­åº”ç”¨

åˆ›å»º `public-path.js` å¹¶åœ¨ `index.js` ä¸­å¼•å…¥ã€‚

### 4. MicroApp åŸºäº WebComponent å®ç°

| æŠ€æœ¯ | è¯´æ˜ |
|---|---|
| **Custom Elements** | å®šä¹‰è‡ªå·±çš„ HTML æ ‡ç­¾ |
| **Shadow DOM** | å°è£…å…ƒç´ çš„æ ‡è®°å’Œæ ·å¼ |
| **HTML Templates** | `<template>` å’Œ `<slot>` æ ‡ç­¾ |
| **ç”Ÿå‘½å‘¨æœŸ** | `connectedCallback`ã€`disconnectedCallback` ç­‰ |

### MicroApp æ ¸å¿ƒç‰¹æ€§

1. **WebComponent ç»„ä»¶åˆ›å»º**ï¼šæ¯ä¸ªå¾®åº”ç”¨ä½œä¸ºè‡ªå®šä¹‰å…ƒç´ å­˜åœ¨
2. **HTML æ¨¡æ¿å¤„ç†**ï¼šå¾®åº”ç”¨ HTML æ”¾ç½®åˆ°å¯¹åº” WebComponent ä¸­
3. **CSS ä½œç”¨åŸŸéš”ç¦»**ï¼šé€šè¿‡ CSS Scoping ç¡®ä¿æ ·å¼éš”ç¦»
4. **JavaScript æ²™ç®±ç¯å¢ƒ**ï¼šé€šè¿‡ Proxy åˆ›å»ºéš”ç¦»ä¸Šä¸‹æ–‡
5. **å…¼å®¹ qiankun**ï¼šæ”¯æŒ qiankun æ”¹é€ çš„å­åº”ç”¨

---

## ä¹ã€wujie çš„å®ç°å’Œä½¿ç”¨

> wujie é‡‡ç”¨ **WebComponent + iframe** çš„æ²™ç®±æ¨¡å¼

### 1. åŸºåº§é…ç½®

```javascript
// src/components/wujie-react.js
import { startApp, setupApp } from 'wujie'

// å°è£… wujie-react ç»„ä»¶
```

### 2. å­åº”ç”¨é…ç½®

```javascript
// m-vue å­åº”ç”¨åŠ ä¸Š webpack è·¨åŸŸæ”¹é€ 
module.exports = {
  devServer: {
    headers: {
      'Access-Control-Allow-Origin': '*',
    },
  },
}
```

---

## åã€Webpack5 æ¨¡å—è”é‚¦ä¸ EMP2 å®è·µ

### 1. åŸºç¡€çŸ¥è¯†

#### EMP2

emp2 æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºä¼ä¸šçº§å¾®å‰ç«¯åº”ç”¨çš„æ¡†æ¶ï¼Œå…è®¸å°†å¤§å‹å‰ç«¯åº”ç”¨åˆ†è§£ä¸ºç‹¬ç«‹çš„æ¨¡å—ã€‚

#### Module Federation

| æ¦‚å¿µ | è¯´æ˜ |
|---|---|
| **åŠ¨æœº** | ä¸åŒå¼€å‘å°ç»„é—´å…±åŒå¼€å‘ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨ |
| **å®¹å™¨** | æ¯ä¸ªåº”ç”¨å—æ˜¯ç‹¬ç«‹æ„å»ºï¼Œç¼–è¯‘ä¸ºå®¹å™¨ |
| **remote** | è¢«å¼•ç”¨çš„å®¹å™¨ï¼Œæš´éœ²æ¨¡å—ç»™ host |
| **host** | å¼•ç”¨è€…ï¼Œä½¿ç”¨ remote æš´éœ²çš„æ¨¡å— |

#### é…ç½®å‚æ•°

| å­—æ®µ | ç±»å‹ | å«ä¹‰ |
|---|---|---|
| `name` | string | è¾“å‡ºçš„æ¨¡å—å |
| `filename` | string | remoteEntry æ–‡ä»¶å |
| `remotes` | object | å…¶ä»–åº”ç”¨çš„å¼•ç”¨æ˜ å°„ |
| `exposes` | object | å½“å‰åº”ç”¨æš´éœ²ç»™å…¶ä»–åº”ç”¨çš„æ¨¡å— |
| `shared` | object | åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«çš„æ¨¡å— |

### 2. webpack-chain

webpack-chain æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºå’Œä¿®æ”¹ Webpack é…ç½®çš„ Node.js åº“ï¼Œæä¾›é“¾å¼ APIã€‚

```javascript
const WebpackChain = require('webpack-chain');
const config = new WebpackChain();

config
  .entry('app')
    .add('./src/index.js')
    .end()
  .output
    .path('/dist')
    .filename('bundle.js');
```

### 3. ç›¸å…³å·¥å…·

| å·¥å…· | è¯´æ˜ |
|---|---|
| `@babel/core` | Babel æ ¸å¿ƒç¼–è¯‘å™¨ |
| `@babel/preset-env` | æ ¹æ®ç›®æ ‡ç¯å¢ƒè‡ªåŠ¨ç¡®å®š Babel æ’ä»¶ |
| `@babel/preset-react` | è½¬æ¢ React JSX è¯­æ³• |
| `html-webpack-plugin` | ç®€åŒ– HTML æ–‡ä»¶åˆ›å»º |
| `webpack-dev-server` | å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒ HMR |

### 4. EMP2 å¯åŠ¨

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run dev
```

### 5. æ ¸å¿ƒé…ç½®ç¤ºä¾‹

```javascript
// config/index.js
const path = require('path');
const webpack = require('webpack');
const WebpackChain = require('webpack-chain');

exports.getConfig = () => {
  const webpackChain = new WebpackChain();
  const configPath = path.resolve(process.cwd(), 'emp-config.js');
  const configExport = require(configPath);
  const config = processDefault(configExport);
  webpackChain.merge(config);
  return webpackChain.toConfig();
}

function processDefault(configExport) {
  const devServer = configExport.server || {};
  delete configExport.server;
  
  const mfOptions = {
    filename: "emp.js",
    ...configExport.empShare
  }
  delete configExport.empShare;
  
  return {
    context: process.cwd(),
    mode: 'development',
    devtool: false,
    devServer,
    plugin: {
      html: {
        plugin: require('html-webpack-plugin'),
        args: [{
          template: path.join(__dirname, '../template/index.html')
        }]
      },
      mf: {
        plugin: webpack.container.ModuleFederationPlugin,
        args: [mfOptions]
      }
    },
    // ... å…¶ä»–é…ç½®
  }
}
```

### 6. æ¨¡æ¿æ–‡ä»¶

```html
<!-- template/index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
  </head>
  <body>
    <div id="emp-root"></div>
  </body>
</html>
```
