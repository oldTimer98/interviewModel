核心点：

1. **理解浏览器限制并发的原因**
2. **掌握对于因为并发数导致的性能问题，可以通过哪些方式进行优化**



## 视频讲解： 

此处为语雀视频卡片，点击链接查看：[为什么浏览器要限制并发连接数.mp4](https://www.yuque.com/u1598738/zqco83/mhkgzoboo7zhgtt8#iixzE)



## What

浏览器的请求并发限制是指浏览器在向服务器发送请求时，限制同时进行的请求数量的机制。这个限制是为了控制资源的使用和网络性能的平衡。

具体来说，浏览器的请求并发限制可以包括以下方面：

1. 域名级别的并发连接数限制：浏览器通常对同一域名下的并发连接数进行限制，即针对同一域名的资源请求只能同时进行一定数量的连接。
2. 单个页面的并发连接数限制：浏览器可能对单个页面中的并发连接数量进行限制，即同一个页面内的资源请求只能同时进行一定数量的连接。
3. 连接类型的并发连接数限制：浏览器可能对不同类型的连接（如普通请求、长轮询、WebSocket等）分别设置并发连接数限制。
4. 浏览器的网络策略：浏览器还可能根据网络状态和负载情况动态调整并发连接数限制，以维护网络性能和资源合理使用。

**拿 Chrome 浏览器来说，同域名下资源加载的最大并发连接数为 6，当资源文件大于 6 时，多于 6 个的文件就会进入待定，等第一批加载完才会加载第二批的6个图片资源，这样就增加了等待时间。无形中就增加用户加载网页等待的时间。**

![img](https://cdn.nlark.com/yuque/0/2023/png/311219/1694940553776-f3baa817-d850-4e3e-9698-06df6254cf2f.png)

## Why

浏览器限制并发连接数是为了平衡网络资源的利用和用户体验。下面是一些原因：

1. **提高性能**：浏览器在同一时间内发送多个并发请求有助于提高页面加载速度。但是，如果同时发送过多的请求，会对网络传输和服务器产生过大的负载，可能导致延迟和拥塞。通过限制并发连接数，可以避免过多的请求同时发送，从而提高整体性能和响应速度。
2. **控制带宽消耗**：每个并发连接都需要占用一定的带宽资源。如果浏览器不进行限制，用户访问网页时可能出现大量并发连接，造成网络带宽耗尽。通过限制并发连接数，可以合理分配带宽资源，避免过度消耗，确保用户和其他应用程序的正常网络使用。
3. http1.x 天然有**队首阻塞**的缺陷，当页面资源内容较多，需要发起大量 http 请求时，同一时间内只能有 x 个请求在连接中，其它都得排队，导致页面整体性能较差
4. 计算机资源有限，且线程切换成本很高，不可能无限制创建 tcp 连接

1. 占用资源：端口(65536)、内核内存、文件描述符、内核文件打开数、tcp连接四元组、数据接收/发送缓冲区、线程(不同语言不同实现，node 下 libuv 也会为每一个 tcp 创建独立线程)
2. 对服务端、客户端都是资源消耗

1. 1.0 之后，keep-alive 使得大多数情况下复用已有连接比创建(三次握手耗时)一个新链接的性能高很多
2. 许多服务器为了防御 ddos 攻击，其实也会限制同一ip过来的连接数，超过会主动关闭
3. 一种平衡策略，防止多个客户端竞争有限资源，导致马太效应

需要注意的是，浏览器对并发连接数的限制是根据不同浏览器和版本而定的，并且可以通过调整浏览器设置或使用特定的技术手段进行修改。同时，服务器也可以通过调整配置来处理更多的并发连接。



## 不同浏览器的请求并发限制

不同的浏览器在限制请求并发方面可能会有一些差异。以下是一些常见的浏览器及其默认的请求并发限制：

1. Google Chrome：对于HTTP/1.1协议，Chrome 通常允许每个域名最多同时进行 6 个并发连接。
2. Mozilla Firefox：Firefox通常允许每个域名最多同时进行 6 到 8 个并发连接。
3. Safari：Safari 通常允许每个域名最多同时进行 6 个并发连接。
4. Microsoft Edge：Edge 通常允许每个域名最多同时进行 6 个并发连接。

需要注意的是，上述数字仅表示默认值，并且可能会受到浏览器版本、网络配置和服务器设置的影响。此外，一些浏览器也提供了高级设置或插件来修改默认的请求并发限制。



## 如何突破浏览器的请求并发限制？

理论而言，突破浏览器的请求并发限制违反了浏览器设计和网络协议的原则，可能会影响用户体验和网站性能，并可能导致一些安全风险和不合法行为。

但是，我们还是有一些方法，能够巧妙的突破浏览器并发限制：

1. 可以添加浏览器启动参数，手动添加并发连接数
2. 可以使用http1.1 的管道功能，部分解决问题
3. 使用多个域名，常见做法是将 **静态资源** 放在其它域名，例如 cdn：使用CDN（内容分发网络）：CDN可以通过将资源分布到多个服务器上，从而缓解单个服务器的压力，提高资源加载速度和可靠性。
4. 合并多种资源，将多个小的资源请求合并成一个大的请求，可以减少请求次数，从而提高性能和响应速度。
5. 可以升级到 http2 (PS: 大概率会紧接着问 http2  的多路复用是怎么实现的，可以回头去看看过去的录播)
6. 延迟加载：将页面中不必要的资源（如图片或视频）延迟加载，可以提高页面打开速度和性能。