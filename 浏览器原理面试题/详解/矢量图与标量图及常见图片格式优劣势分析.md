核心点：

1. **矢量图与位图（标量图）的异同及差异**
2. **不同图片格式之间的差异**
3. **传统图片格式 PNG、JPEG、GIF 对比**
4. **WebP vs JPEG XL vs AVIF vs JPEG 到底应该选取哪个？**



## 矢量图与标量图

- 位图。位图也叫做点阵图，栅格图像，像素图。简单的说，就是最小单位由像素构成的图，缩放会失真。
- 矢量图，也叫做向量图。矢量图并不纪录画面上每一点的信息，而是纪录了元素形状及颜色的算法，无论显示画面是大还是小，画面上的对象对应的算法是不变的，所以，即使对画面进行倍数相当大的缩放，其显示效果仍然相同(不失真)。

![img](https://cdn.nlark.com/yuque/0/2023/png/311219/1693881871629-f4816ca5-32d8-422e-bd10-e4c1c8f15cf1.png)

|          | **矢量图**                                     | **光栅图（位图）**                           |
| -------- | ---------------------------------------------- | -------------------------------------------- |
| 表现形式 | 使用线、点和多边形来表示图像                   | 对矩形格栅内的每个像素的值进行编码来表示图像 |
| 适用图形 | 适用于包含几何形状的图像                       | 适用于包含大量不规则形状和细节的复杂场景     |
| 缩放失真 | 图像与缩放和分辨率无关（缩放不失真）           | 图像与缩放和分辨率有关（放大失真，产生锯齿） |
| 实现形式 | CSS3 \ SVG                                     | JPEG \ GIF \ PNG \WebP                       |
| 图像大小 | 与分辨率和图像大小无关，只与图像的复杂程度有关 | 图像大小与分辨率和图像大小正相关             |

## 不同图片格式之间的差异

从图片的类型上而言，除了常见的 PNG-8/PNG-24，JPEG，GIF 之外，我们更多的关注另外几个较新的图片格式：

- WebP
- JPEG XL
- AVIF

首先，通过一张表格，快速过一下这几个图片，我们将从图片类型、透明通道、动画、编解码性能、压缩算法、颜色支持、内存占用、兼容性方面，对比它们：

| **图片类型**  | **Alpha 通道** | **动画** | **编解码性能**                   | **压缩算法**      | **颜色支持**       | **内存占用** | **兼容性**                           |
| ------------- | -------------- | -------- | -------------------------------- | ----------------- | ------------------ | ------------ | ------------------------------------ |
| GIF           | 支持           | 支持     | 较高                             | 无损压缩          | 索引色(256)        | 基本一致     | ALL                                  |
| PNG-8/ PNG-24 | 支持           | 不支持   | 较高                             | 无损压缩          | 索引色(256)\直接色 | 基本一致     | ALL                                  |
| JPEG          | 不支持         | 不支持   | 较高                             | 有损压缩          | 直接色             | 基本一致     | ALL                                  |
| WebP          | 支持           | 支持     | 编解码性能差（低配设备更为显著） | 有损压缩\无损压缩 | 直接色             | 基本一致     | 高版本 Chrome\Opera\Android          |
| JPEG XL       | 支持           | 支持     | 渐进式解码                       | 有损压缩\无损压缩 | 直接色             | 基本一致     | 部分高版本 Chrome\Opera\Firefox\Edge |
| AVIF          | 支持           | 支持     | 编解码性能一般                   | 有损压缩\无损压缩 | 直接色             | 基本一致     | 高版本 Chrome\Opera\Android\Edge     |

首先，了解了解上述的一些参数含义：

- Alpha 通道：图片是否支持透明的特性

当然，需要指出的是，Alpha 没有透明度的意思，不代表透明度。opacity 和 transparency 才和透明度有关，前者是不透明度，后者是透明度。比如 css 中的「opacity: 0.5」就是设定元素有 50% 的不透明度。后来 Alvy Ray Smith 提出每个像素再增加一个 Alpha 通道，取值为0到1，用来储存这个像素是否对图片有「贡献」，0代表透明、1代表不透明。也就是说，「Alpha 通道」储存一个值，其外在表现是「透明度」，Alpha 和透明度没啥关系

- 动画：很好理解，图片是否支持多帧率动态图片，类似于 GIF
- 编解码性能：图像的解码与编码。这个很关键，很多人对待图片容易忽视图片的编解码性能，解码图像主要从图像文件中读出图像数据，而编码则是将图像数据写入图像文件。解码与编码的过程正好相反。而这两者的性能耗时会影响我们页面的的展示性能。
- 压缩算法：该图片格式是否支持压缩，支持的话，图片的压缩又会分为无损压缩与有损压缩

**有损压缩算法**是一种数据压缩方法，经过此方法压缩、解压的数据会与原始数据不同但是非常接近。原理是借由将次要的信息数据舍弃，牺牲一些质量来减少数据量、提高压缩比

**无损压缩**指数据经过压缩后，信息不受损失，还能完全恢复到压缩前的原样。无损压缩通常用于严格要求“经过压缩、解压缩的数据必须与原始数据一致”的场合。

- 颜色支持：会分为索引色与直接色，在过去，为了节省存储空间，并非所有图片都能支持所有颜色值，因此存在索引色这种优化方式。

**索引颜色**是一种以有限的方式管理数字图像颜色的技术，以节省计算机内存和文件存储，同时加速显示刷新和文件传输。即用一个数字来代表（索引）一种颜色，在存储图片的时候，存储一个数字的组合，同时存储数字到图片颜色的映射。这种方式只能存储有限种颜色。索引色常见有1位（即黑白），8位（即灰阶/256色），16位（即高彩），24位（即真彩），30/36/48位（即全彩）。

**直接色**使用四个数字来代表一种颜色，这四个数字分别代表这个颜色中红色、绿色、蓝色以及透明度（即 RGBA）。现在流行的显示设备可以在这四个维度分别支持256种变化，所以直接色可以表示2的32次方种颜色。

- 内存占用：图片对内存资源的占用
- 兼容性：影响图片格式能否大规模推广的核心要素之一

## 传统图片格式 PNG、JPEG、GIF 对比

- GIF 格式适用于对色彩要求不高同时需要动画的场景；
- PNG-8 拥有比 GIF 更优的压缩率，虽然都是无损压缩，在相同的图片效果下，PNG-8 具有更小的文件体积，并且支持透明度；
- PNG-24 的初衷是用于替代 JPEG，但是一般而言，同等效果下 PNG-24 的文件大小是 JPEG 的五倍之多，而显示效果则通常只能获得一点点提升；
- 得益于更丰富的色彩，JPEG 非常适合用来存储照片，用来表达更生动的图像效果，比如颜色渐变。

## WebP vs JPEG XL vs AVIF 现代图片格式到底应该选取哪个？

这个其实网上有很多不同的声音和检测指标。

推荐大家认真读读这两篇：

1. [现代图片性能优化及体验优化指南](https://juejin.cn/post/7216518492613296188#heading-1)
2. [JPEG XL、AVIF、WebP 2 · 次世代图片格式评测](https://moonvy.com/blog/post/2022/next-generation-Image-format-2022/)

WebP、AVIF 和 JPEG XL 都是浏览器不广泛支持的新型图像格式。虽然 WebP、AVIF 已经存在很长时间，但到今天，影响它们大规模使用的依旧是兼容问题。它们各自有各自的特点与优势，谁能胜出仍未知晓。

- AVIF 有损压缩效果最好，无损压缩非常糟糕。编码速度很慢。
- JPEG XL 无损压缩效果最好，有损压缩较 AVIF 有些许差距。编码速度快。
- WebP 无损压缩效果优秀，有损压缩的上限达到了 AVIF 的水平，但下限很低，不稳定。编码速度很慢。

最好的方案是把 AVIF 用在有损压缩，在照片、纹理、广告等场景使用。把 JPEG XL 用在无损压缩，在 UI 设计、存档等场景使用。

JPEG XL 虽然它的有损压缩不如 AVIF，但比起 JPEG 来说有了非常大的进步，而其无损压缩又有优势，并且在最大图像尺寸、色彩深度上有决定性的优势（在传统的摄影、印刷领域）。另外还是唯一可以无损转换旧有 JPEG 图片到新格式的格式，迁移旧数据不需有所顾虑。只待浏览器支持度能赶上 AVIF 了。